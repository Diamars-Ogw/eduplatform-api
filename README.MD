# ğŸš€ EduPlatform Backend API

Backend Express.js + Prisma pour la plateforme Ã©ducative EduPlatform.

## ğŸ“¦ Installation Rapide

### 1. CrÃ©er le dossier backend et installer les dÃ©pendances

```bash
# Depuis la racine du projet
mkdir -p backend
cd backend

# Copier tous les fichiers fournis dans ce dossier

# Installer les dÃ©pendances
npm install
```

### 2. Configuration de l'environnement

```bash
# Copier le fichier .env.example
cp .env.example .env

# Ã‰diter .env et modifier si nÃ©cessaire
```

### 3. Initialiser la base de donnÃ©es

```bash
# CrÃ©er le dossier prisma et y placer schema.prisma
mkdir -p prisma

# GÃ©nÃ©rer le client Prisma
npm run prisma:generate

# CrÃ©er la base de donnÃ©es
npm run prisma:push

# Peupler avec des donnÃ©es de test
npm run prisma:seed
```

### 4. DÃ©marrer le serveur

```bash
# Mode dÃ©veloppement (avec auto-reload)
npm run dev

# OU Mode production
npm start
```

Le serveur dÃ©marre sur **http://localhost:5000**

## ğŸ“ Structure des Fichiers

```
backend/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # SchÃ©ma de la base de donnÃ©es
â”‚   â””â”€â”€ seed.js                # DonnÃ©es initiales
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.routes.js         # Authentification
â”‚   â”œâ”€â”€ user.routes.js         # Gestion utilisateurs
â”‚   â”œâ”€â”€ promotion.routes.js    # Gestion promotions
â”‚   â”œâ”€â”€ space.routes.js        # Espaces pÃ©dagogiques
â”‚   â”œâ”€â”€ work.routes.js         # Travaux
â”‚   â”œâ”€â”€ submission.routes.js   # Livraisons
â”‚   â””â”€â”€ evaluation.routes.js   # Ã‰valuations
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js                # Middleware JWT
â”‚   â””â”€â”€ errorHandler.js        # Gestion erreurs
â”œâ”€â”€ server.js                  # Point d'entrÃ©e
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example
â”œâ”€â”€ .env                       # Ã€ crÃ©er
â””â”€â”€ eduplatform.db            # Base SQLite (auto-crÃ©Ã©e)
```

## ğŸ”‘ Comptes de Test

AprÃ¨s le seed, utilisez ces comptes (mot de passe: `password123`):

| RÃ´le | Email | Mot de passe |
|------|-------|--------------|
| Directeur | directeur@eduplatform.com | password123 |
| Formateur 1 | formateur1@eduplatform.com | password123 |
| Formateur 2 | formateur2@eduplatform.com | password123 |
| Formateur 3 | formateur3@eduplatform.com | password123 |
| Ã‰tudiant 1-10 | etudiant1@eduplatform.com | password123 |

## ğŸ›£ï¸ Routes API Principales

### Authentification
- `POST /api/auth/login` - Connexion
- `POST /api/auth/change-password` - Changer mot de passe
- `POST /api/auth/forgot-password` - Mot de passe oubliÃ©
- `POST /api/auth/reset-password` - RÃ©initialiser
- `GET /api/auth/verify` - VÃ©rifier token

### Utilisateurs (Directeur)
- `GET /api/users` - Liste utilisateurs
- `POST /api/users` - CrÃ©er utilisateur
- `GET /api/users/:id` - DÃ©tails utilisateur
- `PUT /api/users/:id` - Modifier utilisateur
- `DELETE /api/users/:id` - Supprimer utilisateur
- `PATCH /api/users/:id/toggle-status` - Activer/DÃ©sactiver
- `GET /api/users/inactive/list` - Comptes inactifs

### Promotions
- `GET /api/promotions` - Liste promotions
- `POST /api/promotions` - CrÃ©er promotion (Directeur)
- `GET /api/promotions/:id` - DÃ©tails promotion
- `PUT /api/promotions/:id` - Modifier promotion (Directeur)
- `DELETE /api/promotions/:id` - Supprimer promotion (Directeur)

### Espaces PÃ©dagogiques
- `GET /api/spaces` - Liste espaces (filtrÃ©s par rÃ´le)
- `POST /api/spaces` - CrÃ©er espace (Directeur)
- `GET /api/spaces/:id` - DÃ©tails espace
- `PUT /api/spaces/:id` - Modifier espace (Directeur)
- `POST /api/spaces/:id/enroll` - Inscrire Ã©tudiants (Directeur)
- `GET /api/spaces/matieres` - Liste matiÃ¨res
- `POST /api/spaces/matieres` - CrÃ©er matiÃ¨re (Directeur)

### Travaux
- `GET /api/works` - Liste travaux (filtrÃ©s par rÃ´le)
- `POST /api/works` - CrÃ©er travail (Formateur)
- `GET /api/works/:id` - DÃ©tails travail
- `PUT /api/works/:id` - Modifier travail (Formateur)
- `POST /api/works/:id/assign-individual` - Affecter individuellement
- `POST /api/works/:id/groups` - CrÃ©er groupe
- `GET /api/works/student/my-works` - Mes travaux (Ã‰tudiant)

### Livraisons
- `POST /api/submissions/individual/:affectationId` - Soumettre individuel (Ã‰tudiant)
- `POST /api/submissions/group/:groupeId` - Soumettre groupe (Ã‰tudiant)
- `GET /api/submissions/work/:travailId` - Liste livraisons (Formateur)
- `GET /api/submissions/:id` - DÃ©tails livraison
- `GET /api/submissions/student/my-submissions` - Mes livraisons (Ã‰tudiant)

### Ã‰valuations
- `POST /api/evaluations` - Ã‰valuer (Formateur)
- `PUT /api/evaluations/:id` - Modifier Ã©valuation (Directeur)
- `GET /api/evaluations/:id` - DÃ©tails Ã©valuation
- `GET /api/evaluations/student/my-grades` - Mes notes (Ã‰tudiant)
- `GET /api/evaluations/student/grades-by-subject` - Notes par matiÃ¨re (Ã‰tudiant)
- `GET /api/evaluations/stats/global` - Statistiques (Directeur)

## ğŸ”’ Authentification

Toutes les routes (sauf `/api/auth/login`) nÃ©cessitent un token JWT dans le header:

```javascript
headers: {
  'Authorization': 'Bearer <votre-token-jwt>'
}
```

## ğŸ§ª Tester l'API

### Avec curl

```bash
# Login
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"directeur@eduplatform.com","motDePasse":"password123"}'

# Utiliser le token retournÃ© pour les autres requÃªtes
curl http://localhost:5000/api/users \
  -H "Authorization: Bearer <votre-token>"
```

### Avec Prisma Studio

```bash
# Ouvrir l'interface graphique de la base de donnÃ©es
npm run prisma:studio
```

## ğŸ”§ Scripts npm Disponibles

```bash
npm run dev              # DÃ©marre en mode dÃ©veloppement
npm start                # DÃ©marre en mode production
npm run prisma:generate  # GÃ©nÃ¨re le client Prisma
npm run prisma:push      # Applique le schÃ©ma Ã  la DB
npm run prisma:studio    # Ouvre l'interface graphique
npm run prisma:seed      # Peuple la DB avec donnÃ©es test
npm run setup            # Setup complet (generate + push + seed)
```

## ğŸŒ Connexion avec le Frontend

### 1. Configuration du Frontend

Dans votre frontend React, crÃ©ez/modifiez `src/services/api.js`:

```javascript
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';

const api = axios.create({
  baseURL: API_URL,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Intercepteur pour ajouter le token
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

export default api;
```

### 2. Variables d'environnement Frontend

CrÃ©ez `.env` dans le frontend:

```env
VITE_API_URL=http://localhost:5000/api
```

### 3. Exemple d'utilisation dans le Frontend

```javascript
import api from './services/api';

// Login
const login = async (email, motDePasse) => {
  const response = await api.post('/auth/login', { email, motDePasse });
  localStorage.setItem('token', response.data.token);
  localStorage.setItem('user', JSON.stringify(response.data.user));
  return response.data;
};

// RÃ©cupÃ©rer les utilisateurs
const getUsers = async () => {
  const response = await api.get('/users');
  return response.data;
};
```

## ğŸš€ DÃ©ploiement

### Option 1: Render.com (RecommandÃ©)

1. CrÃ©er un compte sur [Render.com](https://render.com)
2. CrÃ©er un nouveau "Web Service"
3. Connecter votre repo GitHub
4. Configuration:
   - **Build Command**: `npm install && npm run setup`
   - **Start Command**: `npm start`
   - **Environment Variables**: Ajouter les variables du `.env`

### Option 2: Railway

1. CrÃ©er un compte sur [Railway.app](https://railway.app)
2. CrÃ©er un nouveau projet depuis GitHub
3. Ajouter les variables d'environnement
4. Railway dÃ©tectera automatiquement Node.js

### Option 3: Heroku

```bash
# Installer Heroku CLI puis:
heroku create eduplatform-api
git push heroku main
heroku config:set JWT_SECRET=votre-secret
```

## ğŸ› DÃ©pannage

### La base de donnÃ©es n'est pas crÃ©Ã©e
```bash
rm -f prisma/eduplatform.db
npm run prisma:push
npm run prisma:seed
```

### Erreur "Cannot find module"
```bash
rm -rf node_modules package-lock.json
npm install
```

### Port dÃ©jÃ  utilisÃ©
Modifiez le `PORT` dans `.env` ou arrÃªtez le processus:
```bash
# Linux/Mac
lsof -ti:5000 | xargs kill

# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F
```

## ğŸ“ Notes Importantes

- **Base de donnÃ©es**: SQLite (fichier `eduplatform.db`)
- **JWT Secret**: CHANGEZ-LE en production !
- **CORS**: ConfigurÃ© pour `http://localhost:5173` (frontend Vite)
- **Upload de fichiers**: Non implÃ©mentÃ© (utilisez Cloudinary/S3)
- **Emails**: Non implÃ©mentÃ©s (ajoutez Nodemailer)

## ğŸ¯ Prochaines Ã‰tapes

1. âœ… Backend fonctionnel
2. ğŸ”„ Adapter les appels API dans le frontend
3. ğŸ§ª Tester toutes les fonctionnalitÃ©s
4. ğŸš€ DÃ©ployer backend et frontend
5. ğŸ” SÃ©curiser en production

## ğŸ†˜ Besoin d'Aide ?

Si vous rencontrez des problÃ¨mes:
1. VÃ©rifiez les logs du serveur
2. VÃ©rifiez que toutes les dÃ©pendances sont installÃ©es
3. Assurez-vous que le port 5000 est libre
4. VÃ©rifiez le fichier `.env`

Bon courage ! ğŸš€